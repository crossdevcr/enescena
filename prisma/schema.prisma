generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ARTIST
  VENUE
  ADMIN
}

enum PerformanceStatus {
  PENDING      // Waiting for artist/venue confirmation
  CONFIRMED    // Both parties agreed
  DECLINED     // Artist declined or venue rejected
  CANCELLED    // Cancelled after confirmation
  COMPLETED    // Performance finished
}

enum EventStatus {
  DRAFT          // Being created
  SEEKING_VENUE  // Artist looking for venue
  SEEKING_ARTISTS // Venue looking for more artists
  PENDING        // Waiting for confirmations
  CONFIRMED      // All parties agreed
  PUBLISHED      // Public and promoted
  CANCELLED      
  COMPLETED
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      UserRole @default(ARTIST)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  artist       Artist?
  venue        Venue?
  createdEvents Event[] @relation("EventCreator")
}

model Artist {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  name     String
  slug     String   @unique
  city     String?
  genres   String[] // Postgres text[]
  rate     Int?     // Default hourly rate
  imageUrl String?
  bio      String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  performances         Performance[]
  unavailabilities     ArtistUnavailability[]
}

model Venue {
  id     String @id @default(cuid())
  userId String @unique
  user   User   @relation(fields: [userId], references: [id])

  name     String
  slug     String  @unique
  city     String?
  address  String?
  imageUrl String?
  about    String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  hostedEvents Event[] @relation("VenueHostedEvents")
}



model ArtistUnavailability {
  id       String @id @default(cuid())
  artistId String
  artist   Artist @relation(fields: [artistId], references: [id], onDelete: Cascade)

  start  DateTime
  end    DateTime
  reason String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([artistId, start, end])
}

model Event {
  id        String      @id @default(cuid())
  
  // Creator (can be artist or venue user)
  createdBy String
  creator   User        @relation("EventCreator", fields: [createdBy], references: [id])
  
  // Venue (optional - can be external)
  venueId   String?
  venue     Venue?      @relation("VenueHostedEvents", fields: [venueId], references: [id])
  
  // External venue details (when venue not in system)
  externalVenueName    String?
  externalVenueAddress String?
  externalVenueCity    String?
  externalVenueContact String? // Phone/email for external venue
  
  // Event details
  title       String
  slug        String      @unique
  description String?
  eventDate   DateTime
  endDate     DateTime? // Optional end date for multi-day events
  totalHours  Int?      // Total event duration
  totalBudget Int?      // Total budget for all performances
  imageUrl    String?
  status      EventStatus @default(DRAFT)
  isPublic    Boolean @default(true) // Public events vs private gigs

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  performances Performance[]

  @@index([createdBy, eventDate])
  @@index([venueId, eventDate])
  @@index([status, eventDate])
  @@index([slug])
  @@index([eventDate, isPublic])
}

model Performance {
  id       String @id @default(cuid())
  eventId  String
  artistId String
  
  event  Event  @relation(fields: [eventId], references: [id], onDelete: Cascade)
  artist Artist @relation(fields: [artistId], references: [id], onDelete: Cascade)

  // Performance details
  agreedFee    Int?              // Final agreed payment
  proposedFee  Int?              // Initial fee proposal
  hours        Int?              // Performance duration
  startTime    DateTime?         // Specific start time if different from event
  endTime      DateTime?         // Specific end time
  
  // Status and communication
  status       PerformanceStatus @default(PENDING)
  notes        String?           // General notes
  artistNotes  String?           // Artist-specific requirements
  venueNotes   String?           // Venue-specific notes
  
  // Contract details
  equipmentProvided String?      // What equipment venue provides
  soundcheckTime   DateTime?    // Soundcheck schedule
  paymentTerms     String?      // Payment schedule details
  cancellationTerms String?     // Cancellation policy
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([eventId, artistId]) // Prevent duplicate artist assignments
  @@index([eventId])
  @@index([artistId])
  @@index([status, createdAt])
  @@index([artistId, status])
}
